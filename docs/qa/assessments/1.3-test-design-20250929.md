# Test Design: Story 1.3 - Setup Wizard Implementation

**Date**: 2025-09-29
**Designer**: Quinn (Test Architect)
**Story**: 1.3 - Setup Wizard Implementation

---

## Test Strategy Overview

- **Total Test Scenarios**: 87
- **Unit Tests**: 45 (52%)
- **Integration Tests**: 32 (37%)
- **E2E Tests**: 10 (11%)
- **Priority Distribution**: P0: 28, P1: 35, P2: 18, P3: 6

### Coverage Summary

| Acceptance Criterion | Unit | Integration | E2E | Total |
| -------------------- | ---- | ----------- | --- | ----- |
| AC1: Interactive CLI | 8    | 6           | 3   | 17    |
| AC2: Bun Config      | 7    | 5           | 1   | 13    |
| AC3: ESLint/Prettier | 10   | 7           | 2   | 19    |
| AC4: TypeScript      | 8    | 5           | 1   | 14    |
| AC5: Validation      | 6    | 5           | 2   | 13    |
| AC6: Rollback        | 6    | 4           | 1   | 11    |

### Test Pyramid Compliance

```
       E2E: 10 (11%)     ▲
    Integration: 32 (37%) ███
Unit: 45 (52%)            ██████
```

**Assessment**: Healthy test pyramid with appropriate shift-left strategy. Majority of tests at unit level for fast feedback, integration tests for critical interactions, E2E reserved for critical user journeys.

---

## Test Scenarios by Acceptance Criteria

### AC1: Interactive CLI Wizard with Step-by-Step Configuration

#### Unit Tests (8 scenarios)

| Test ID      | Priority | Scenario                                   | Justification                             | Mitigates Risk |
| ------------ | -------- | ------------------------------------------ | ----------------------------------------- | -------------- |
| 1.3-UNIT-001 | P0       | Wizard state machine transitions           | Pure state logic, prevents invalid states | TECH-001       |
| 1.3-UNIT-002 | P0       | Input validation for project path          | Security-critical validation logic        | SEC-002        |
| 1.3-UNIT-003 | P1       | Step navigation (next/back/skip)           | State transition logic                    | TECH-001       |
| 1.3-UNIT-004 | P1       | Progress calculation (current/total steps) | Simple calculation, UI display logic      | -              |
| 1.3-UNIT-005 | P1       | Wizard step data serialization             | Data transformation logic                 | DATA-001       |
| 1.3-UNIT-006 | P2       | User input sanitization                    | String processing, security validation    | SEC-001        |
| 1.3-UNIT-007 | P2       | Step completion validation                 | Business rule validation                  | -              |
| 1.3-UNIT-008 | P3       | Wizard theme color selection               | UI customization, low risk                | -              |

#### Integration Tests (6 scenarios)

| Test ID     | Priority | Scenario                                          | Justification                                    | Mitigates Risk |
| ----------- | -------- | ------------------------------------------------- | ------------------------------------------------ | -------------- |
| 1.3-INT-001 | P0       | Wizard orchestrates detection → generation → save | Multi-service coordination, critical workflow    | TECH-001       |
| 1.3-INT-002 | P0       | Async operations don't corrupt wizard state       | State management with async, race condition test | TECH-001       |
| 1.3-INT-003 | P1       | Ink component renders steps correctly             | UI framework integration                         | PERF-002       |
| 1.3-INT-004 | P1       | Zustand store updates propagate to UI             | State management integration                     | TECH-001       |
| 1.3-INT-005 | P2       | Wizard handles Ctrl+C gracefully                  | Signal handling, cleanup integration             | OPS-001        |
| 1.3-INT-006 | P2       | Wizard resumes from interruption point            | State persistence across interruptions           | DATA-003       |

#### E2E Tests (3 scenarios)

| Test ID     | Priority | Scenario                                        | Justification                              | Mitigates Risk |
| ----------- | -------- | ----------------------------------------------- | ------------------------------------------ | -------------- |
| 1.3-E2E-001 | P0       | User completes full wizard flow (happy path)    | Critical user journey validation           | BUS-001        |
| 1.3-E2E-002 | P1       | User navigates back to change previous answers  | Real user behavior pattern                 | TECH-001       |
| 1.3-E2E-003 | P2       | User cancels wizard mid-flow, configs unchanged | Cancellation workflow, rollback validation | OPS-001        |

---

### AC2: Automatic Bun Test Configuration Generation

#### Unit Tests (7 scenarios)

| Test ID      | Priority | Scenario                                        | Justification                    | Mitigates Risk |
| ------------ | -------- | ----------------------------------------------- | -------------------------------- | -------------- |
| 1.3-UNIT-009 | P0       | Generate valid bunfig.toml structure            | Config generation logic          | TECH-003       |
| 1.3-UNIT-010 | P0       | Apply 80% coverage threshold default            | Business rule, critical for QA   | -              |
| 1.3-UNIT-011 | P1       | Detect project structure for test path patterns | Pattern matching logic           | TECH-004       |
| 1.3-UNIT-012 | P1       | Generate preload configuration                  | Config assembly logic            | -              |
| 1.3-UNIT-013 | P1       | Merge with existing Bun config                  | Config merge algorithm           | TECH-003       |
| 1.3-UNIT-014 | P2       | Custom coverage threshold validation (0-100)    | Input validation, range checking | -              |
| 1.3-UNIT-015 | P3       | Support alternative config file locations       | Edge case, rare configuration    | -              |

#### Integration Tests (5 scenarios)

| Test ID     | Priority | Scenario                                   | Justification                       | Mitigates Risk |
| ----------- | -------- | ------------------------------------------ | ----------------------------------- | -------------- |
| 1.3-INT-007 | P0       | Write bunfig.toml to project root          | File I/O with config generator      | OPS-001        |
| 1.3-INT-008 | P0       | Validate Bun test execution with config    | Config validation through execution | TECH-002       |
| 1.3-INT-009 | P1       | Backup existing bunfig.toml before write   | Rollback system integration         | OPS-001        |
| 1.3-INT-010 | P2       | Handle permission errors on config write   | Error handling, file system edge    | OPS-002        |
| 1.3-INT-011 | P2       | Merge package.json test config with bunfig | Multi-source config resolution      | TECH-003       |

#### E2E Tests (1 scenario)

| Test ID     | Priority | Scenario                                     | Justification                      | Mitigates Risk |
| ----------- | -------- | -------------------------------------------- | ---------------------------------- | -------------- |
| 1.3-E2E-004 | P1       | Generated Bun config runs tests successfully | End-to-end validation of generated | TECH-002       |
|             |          | in sample project                            | config                             |                |

---

### AC3: ESLint and Prettier Configuration Setup with Project-Specific Rules

#### Unit Tests (10 scenarios)

| Test ID      | Priority | Scenario                                          | Justification                       | Mitigates Risk |
| ------------ | -------- | ------------------------------------------------- | ----------------------------------- | -------------- |
| 1.3-UNIT-016 | P0       | Sanitize ESLint rule names (prevent injection)    | Security validation, critical       | SEC-001        |
| 1.3-UNIT-017 | P0       | Generate JSON ESLint config (no JS execution)     | Security control, no code execution | SEC-001        |
| 1.3-UNIT-018 | P0       | Sanitize Prettier config values                   | Security validation                 | SEC-001        |
| 1.3-UNIT-019 | P1       | Detect existing ESLint config format              | Config format detection logic       | TECH-003       |
| 1.3-UNIT-020 | P1       | Merge ESLint rules (preserve user customizations) | Merge algorithm                     | TECH-003       |
| 1.3-UNIT-021 | P1       | Generate .prettierignore from project structure   | Pattern generation logic            | -              |
| 1.3-UNIT-022 | P1       | Detect code style (tabs vs spaces, quotes)        | Pattern analysis logic              | BUS-001        |
| 1.3-UNIT-023 | P2       | Add TypeScript ESLint plugins                     | Plugin configuration logic          | -              |
| 1.3-UNIT-024 | P2       | Configure ESLint-Prettier integration             | Config composition                  | -              |
| 1.3-UNIT-025 | P3       | Support both flat and legacy ESLint formats       | Format compatibility logic          | -              |

#### Integration Tests (7 scenarios)

| Test ID     | Priority | Scenario                                        | Justification                       | Mitigates Risk |
| ----------- | -------- | ----------------------------------------------- | ----------------------------------- | -------------- |
| 1.3-INT-012 | P0       | Write ESLint config, verify no code injection   | Security test, file write + execute | SEC-001        |
| 1.3-INT-013 | P0       | Write Prettier config, verify no code injection | Security test                       | SEC-001        |
| 1.3-INT-014 | P1       | Run ESLint validation on generated config       | Config validation via tool          | OPS-002        |
| 1.3-INT-015 | P1       | Run Prettier validation on generated config     | Config validation                   | OPS-002        |
| 1.3-INT-016 | P1       | Backup existing ESLint/Prettier configs         | Rollback integration                | OPS-001        |
| 1.3-INT-017 | P2       | Merge scenario: Existing + DevQuality rules     | Complex merge integration           | TECH-003       |
| 1.3-INT-018 | P2       | Handle conflicting ESLint and Prettier rules    | Config conflict resolution          | BUS-001        |

#### E2E Tests (2 scenarios)

| Test ID     | Priority | Scenario                                        | Justification               | Mitigates Risk |
| ----------- | -------- | ----------------------------------------------- | --------------------------- | -------------- |
| 1.3-E2E-005 | P0       | ESLint config injection attempt blocked         | Security E2E test           | SEC-001        |
| 1.3-E2E-006 | P1       | Generated configs lint sample code successfully | Real-world usage validation | BUS-001        |

---

### AC4: TypeScript Integration with Proper Compiler Options

#### Unit Tests (8 scenarios)

| Test ID      | Priority | Scenario                                        | Justification                   | Mitigates Risk |
| ------------ | -------- | ----------------------------------------------- | ------------------------------- | -------------- |
| 1.3-UNIT-026 | P0       | Generate strict mode tsconfig                   | Critical TS config, type safety | -              |
| 1.3-UNIT-027 | P1       | Detect existing tsconfig and extends chain      | Config detection logic          | TECH-003       |
| 1.3-UNIT-028 | P1       | Merge compiler options (preserve user settings) | Merge algorithm                 | TECH-003       |
| 1.3-UNIT-029 | P1       | Generate path aliases from project structure    | Path mapping generation         | TECH-004       |
| 1.3-UNIT-030 | P1       | Configure include/exclude patterns              | Pattern generation logic        | -              |
| 1.3-UNIT-031 | P2       | Validate path alias safety (no traversal)       | Security validation             | SEC-002        |
| 1.3-UNIT-032 | P2       | Set appropriate target based on package.json    | Smart default selection         | -              |
| 1.3-UNIT-033 | P3       | Support monorepo tsconfig references            | Advanced TS config              | TECH-004       |

#### Integration Tests (5 scenarios)

| Test ID     | Priority | Scenario                                 | Justification                  | Mitigates Risk |
| ----------- | -------- | ---------------------------------------- | ------------------------------ | -------------- |
| 1.3-INT-019 | P0       | Write tsconfig.json to project root      | File write integration         | OPS-001        |
| 1.3-INT-020 | P0       | Run TypeScript validation (tsc --noEmit) | Config validation via compiler | TECH-002       |
| 1.3-INT-021 | P1       | Backup existing tsconfig before write    | Rollback integration           | OPS-001        |
| 1.3-INT-022 | P1       | Merge with tsconfig extends chain        | Complex inheritance resolution | TECH-003       |
| 1.3-INT-023 | P2       | Handle TypeScript version compatibility  | Version-specific config        | -              |

#### E2E Tests (1 scenario)

| Test ID     | Priority | Scenario                                   | Justification               | Mitigates Risk |
| ----------- | -------- | ------------------------------------------ | --------------------------- | -------------- |
| 1.3-E2E-007 | P1       | Generated tsconfig compiles sample project | Real-world compilation test | TECH-002       |

---

### AC5: Configuration Validation and Testing

#### Unit Tests (6 scenarios)

| Test ID      | Priority | Scenario                                        | Justification             | Mitigates Risk |
| ------------ | -------- | ----------------------------------------------- | ------------------------- | -------------- |
| 1.3-UNIT-034 | P0       | Validation timeout per tool (60s)               | Resource management logic | PERF-001       |
| 1.3-UNIT-035 | P1       | Parse validation output for errors              | Output parsing logic      | OPS-002        |
| 1.3-UNIT-036 | P1       | Aggregate validation results                    | Data aggregation          | -              |
| 1.3-UNIT-037 | P1       | Validation concurrency limiter (max 2 parallel) | Semaphore logic           | PERF-001       |
| 1.3-UNIT-038 | P2       | Generate user-friendly error messages           | String formatting         | OPS-002        |
| 1.3-UNIT-039 | P3       | Skip validation for user-requested tools        | Conditional logic         | -              |

#### Integration Tests (5 scenarios)

| Test ID     | Priority | Scenario                                        | Justification                  | Mitigates Risk |
| ----------- | -------- | ----------------------------------------------- | ------------------------------ | -------------- |
| 1.3-INT-024 | P0       | Run all validations in parallel (resource test) | Performance + correctness test | PERF-001       |
| 1.3-INT-025 | P0       | Validation failure triggers rollback            | Critical error handling flow   | OPS-001        |
| 1.3-INT-026 | P1       | Display validation progress in UI               | UI integration with validation | PERF-002       |
| 1.3-INT-027 | P2       | Validation timeout handled gracefully           | Timeout integration            | TECH-002       |
| 1.3-INT-028 | P2       | Retry failed validation once                    | Retry logic integration        | -              |

#### E2E Tests (2 scenarios)

| Test ID     | Priority | Scenario                                          | Justification                    | Mitigates Risk |
| ----------- | -------- | ------------------------------------------------- | -------------------------------- | -------------- |
| 1.3-E2E-008 | P0       | All tools validate successfully in real project   | Critical validation workflow     | TECH-002       |
| 1.3-E2E-009 | P1       | Validation failure shows actionable error to user | User experience, error reporting | OPS-002        |

---

### AC6: Rollback Capability for Failed Configurations

#### Unit Tests (6 scenarios)

| Test ID      | Priority | Scenario                             | Justification              | Mitigates Risk |
| ------------ | -------- | ------------------------------------ | -------------------------- | -------------- |
| 1.3-UNIT-040 | P0       | Create backup metadata structure     | Data structure correctness | OPS-001        |
| 1.3-UNIT-041 | P0       | Validate backup integrity check      | Verification logic         | OPS-001        |
| 1.3-UNIT-042 | P1       | Rollback transaction idempotence     | Ensures safe retry         | OPS-001        |
| 1.3-UNIT-043 | P1       | Cleanup backup files after success   | Resource cleanup logic     | DATA-002       |
| 1.3-UNIT-044 | P2       | Generate rollback operation sequence | Transaction planning logic | OPS-001        |
| 1.3-UNIT-045 | P3       | Backup file naming convention        | String formatting          | -              |

#### Integration Tests (4 scenarios)

| Test ID     | Priority | Scenario                                      | Justification                   | Mitigates Risk |
| ----------- | -------- | --------------------------------------------- | ------------------------------- | -------------- |
| 1.3-INT-029 | P0       | Atomic rollback on partial failure            | Critical data integrity test    | OPS-001        |
| 1.3-INT-030 | P0       | Rollback during active write (file lock test) | Race condition, data corruption | OPS-001        |
| 1.3-INT-031 | P1       | Backup and restore all config types           | Multi-file transaction          | OPS-001        |
| 1.3-INT-032 | P2       | Rollback preserves original file permissions  | File metadata preservation      | -              |

#### E2E Tests (1 scenario)

| Test ID     | Priority | Scenario                                        | Justification                | Mitigates Risk |
| ----------- | -------- | ----------------------------------------------- | ---------------------------- | -------------- |
| 1.3-E2E-010 | P0       | User cancels wizard, all files restored exactly | Critical rollback validation | OPS-001        |

---

## Risk Coverage Matrix

### Critical Risks (P0 Mitigation)

| Risk ID  | Risk Title                       | Test Coverage                                         | Tests Count |
| -------- | -------------------------------- | ----------------------------------------------------- | ----------- |
| TECH-001 | Interactive CLI State Management | 1.3-UNIT-001, 1.3-UNIT-003, INT-001, INT-002, INT-004 | 5           |
| SEC-001  | Configuration File Injection     | 1.3-UNIT-016, 017, 018, INT-012, INT-013, E2E-005     | 6           |
| OPS-001  | Rollback Failure                 | 1.3-UNIT-040, 041, 042, INT-029, INT-030, E2E-010     | 6           |

### High Risks (P0/P1 Mitigation)

| Risk ID  | Risk Title                   | Test Coverage                            | Tests Count |
| -------- | ---------------------------- | ---------------------------------------- | ----------- |
| TECH-002 | Detection Engine Timeout     | 1.3-INT-008, 020, 027, E2E-004, 007, 008 | 6           |
| DATA-001 | SQLite Write Failure         | 1.3-UNIT-005 (serialization prep)        | 1           |
| PERF-001 | Parallel Validation Resource | 1.3-UNIT-034, 037, INT-024               | 3           |
| SEC-002  | Path Traversal               | 1.3-UNIT-002, 031                        | 2           |

### Medium Risks (P1/P2 Mitigation)

| Risk ID  | Risk Title                          | Test Coverage                             | Tests Count |
| -------- | ----------------------------------- | ----------------------------------------- | ----------- |
| TECH-003 | TypeScript Config Merge             | 1.3-UNIT-013, 020, 027, 028, INT-017, 022 | 6           |
| DATA-002 | Backup Files Not Cleaned Up         | 1.3-UNIT-043                              | 1           |
| PERF-002 | Wizard UI Blocks on Async           | 1.3-INT-003, 026                          | 2           |
| BUS-001  | Generated Configs Don't Match Style | 1.3-UNIT-022, INT-018, E2E-006            | 3           |

### Low Risks (P2/P3 Mitigation)

| Risk ID  | Risk Title                    | Test Coverage                       | Tests Count |
| -------- | ----------------------------- | ----------------------------------- | ----------- |
| OPS-002  | Insufficient Error Messages   | 1.3-UNIT-038, INT-014, 015, E2E-009 | 4           |
| DATA-003 | Detection Cache Stale         | 1.3-INT-006                         | 1           |
| TECH-004 | Monorepo Detection Incomplete | 1.3-UNIT-011, 029, 033              | 3           |

**Risk Mitigation Assessment**: All identified risks have dedicated test coverage, with critical risks (score 9) receiving 5-6 tests each across multiple levels.

---

## Test Scenario Details

### Security-Critical Tests (Expanded)

#### 1.3-UNIT-016: Sanitize ESLint Rule Names

**Priority**: P0
**Risk**: SEC-001 (Critical)

**Test Vectors**:

```typescript
const injectionVectors = [
  "require('child_process').exec('rm -rf /')",
  "'; DROP TABLE users; --",
  '../../../etc/passwd',
  '__proto__.isAdmin',
  "constructor.constructor('return process')().exit()",
  '${process.env.SECRET}',
];
```

**Expected Behavior**: All vectors rejected, only `[a-zA-Z0-9-_/]` allowed in rule names

**Assertion**: Generated config contains no `require`, `process`, `constructor`, or path traversal

---

#### 1.3-INT-012: Write ESLint Config, Verify No Code Injection

**Priority**: P0
**Risk**: SEC-001 (Critical)

**Test Steps**:

1. Generate ESLint config with sanitized inputs
2. Write config to temporary directory
3. Import config as module (Node.js require)
4. Execute ESLint with config on sample file
5. Monitor child process for suspicious activity

**Assertion**: No child processes spawned, no file system access outside project, ESLint runs normally

---

#### 1.3-E2E-005: ESLint Config Injection Attempt Blocked

**Priority**: P0
**Risk**: SEC-001 (Critical)

**User Journey**:

1. User runs `dev-quality setup`
2. Wizard prompts for custom ESLint rule
3. User enters: `require('child_process').exec('curl malicious.com')`
4. Wizard validates input and rejects
5. User sees error: "Invalid rule name. Only alphanumeric characters, hyphens, and underscores allowed."
6. Wizard prompts again for valid input

**Assertion**: Malicious code never written to config file, never executed

---

### State Management Tests (Expanded)

#### 1.3-UNIT-001: Wizard State Machine Transitions

**Priority**: P0
**Risk**: TECH-001 (Critical)

**State Diagram**:

```
IDLE → DETECTING → CONFIGURING → VALIDATING → SAVING → COMPLETE
     ↑                                                       ↓
     ←───────────── ERROR (rollback) ←──────────────────────┘
```

**Test Cases**:

1. Valid transition: IDLE → DETECTING (✓)
2. Invalid transition: IDLE → VALIDATING (✗)
3. Error transition from any state → ERROR (✓)
4. Back navigation: CONFIGURING → DETECTING (✓)
5. Skip validation: CONFIGURING → SAVING (✓ if user overrides)

**Assertion**: State machine never enters invalid state, all transitions logged

---

#### 1.3-INT-002: Async Operations Don't Corrupt Wizard State

**Priority**: P0
**Risk**: TECH-001 (Critical)

**Test Scenario**:

```typescript
// Simulate race condition
async function testRaceCondition() {
  const wizard = new WizardService();

  // Start detection
  const detectionPromise = wizard.runDetection();

  // User immediately clicks "next" (race condition)
  await wait(10); // 10ms delay
  const nextPromise = wizard.goToNextStep();

  // Wait for both to complete
  await Promise.all([detectionPromise, nextPromise]);

  // Verify state consistency
  expect(wizard.state).toBeConsistent();
  expect(wizard.detectionResults).toBeLoaded();
}
```

**Assertion**: State remains consistent, no partial data, no undefined access errors

---

### Rollback Tests (Expanded)

#### 1.3-INT-029: Atomic Rollback on Partial Failure

**Priority**: P0
**Risk**: OPS-001 (Critical)

**Test Steps**:

1. Wizard generates 3 config files: `bunfig.toml`, `.eslintrc.json`, `tsconfig.json`
2. Mock: `tsconfig.json` write fails (disk full error)
3. Trigger rollback
4. Verify all 3 files restored to original state (bunfig and eslintrc not left modified)

**Assertion**: Either all configs written or none, no partial state

---

#### 1.3-INT-030: Rollback During Active Write (File Lock Test)

**Priority**: P0
**Risk**: OPS-001 (Critical)

**Test Steps**:

1. Start writing `eslintrc.json` (5MB test file, slow write)
2. After 50% write, trigger Ctrl+C
3. Rollback service attempts to restore file
4. Verify file handle closed before rollback
5. Verify restored file is complete original, not corrupted partial write

**Assertion**: No file corruption, no locked file errors, complete restoration

---

#### 1.3-E2E-010: User Cancels Wizard, All Files Restored Exactly

**Priority**: P0
**Risk**: OPS-001 (Critical)

**User Journey**:

1. User has existing configs: `eslintrc.json` (custom rules), `tsconfig.json` (custom paths)
2. User runs `dev-quality setup`
3. Wizard backs up existing configs
4. Wizard generates new configs, writes `bunfig.toml` (new file)
5. User presses Ctrl+C during validation step
6. Wizard displays: "Rolling back changes..."
7. Wizard displays: "Rollback complete. Original files restored."

**Assertion**:

- `eslintrc.json` and `tsconfig.json` match original byte-for-byte (checksum)
- `bunfig.toml` deleted (didn't exist before)
- No backup files remain in project directory

---

## Test Data Requirements

### Fixture Projects

**Required Test Projects**:

1. **JavaScript Only Project** (`fixtures/js-only`)
   - No TypeScript, no existing configs
   - Tests: Baseline wizard flow

2. **TypeScript Project** (`fixtures/ts-project`)
   - Existing `tsconfig.json`, no ESLint/Prettier
   - Tests: TS integration, config merge

3. **Fully Configured Project** (`fixtures/fully-configured`)
   - All configs present (ESLint, Prettier, TS, Bun)
   - Tests: Merge scenarios, user choice handling

4. **Monorepo** (`fixtures/monorepo`)
   - Yarn workspaces with 3 packages
   - Tests: Package detection, config placement

5. **Large Project** (`fixtures/large-5000-files`)
   - 5000+ files for performance testing
   - Tests: Detection timeout, memory usage

6. **Legacy Project** (`fixtures/legacy-eslintrc`)
   - Old `.eslintrc.js` (not flat config)
   - Tests: Format migration, compatibility

### Mock Data

**User Input Scenarios**:

- Valid project paths: `/Users/test/project`, `/home/user/app`
- Invalid paths: `../../../etc`, `C:\Windows\System32`, `/dev/null`
- Custom rule names: Valid (`no-console`, `max-len`) vs Invalid (injection vectors)
- Coverage thresholds: Valid (0, 50, 80, 100) vs Invalid (-1, 101, `DROP TABLE`)

---

## Recommended Test Execution Order

### Phase 1: Fast Fail (P0 Unit) - 2 minutes

```bash
# Critical security and logic tests first
bun test 1.3-UNIT-001 # State machine
bun test 1.3-UNIT-002 # Path validation
bun test 1.3-UNIT-016 # Injection prevention
bun test 1.3-UNIT-017 # JSON config generation
bun test 1.3-UNIT-018 # Prettier sanitization
bun test 1.3-UNIT-026 # TS strict mode
bun test 1.3-UNIT-034 # Validation timeout
bun test 1.3-UNIT-040 # Backup metadata
bun test 1.3-UNIT-041 # Backup integrity
```

### Phase 2: Integration (P0) - 10 minutes

```bash
# Critical multi-component flows
bun test 1.3-INT-001  # Wizard orchestration
bun test 1.3-INT-002  # Async state consistency
bun test 1.3-INT-007  # Bun config write
bun test 1.3-INT-012  # ESLint injection prevention
bun test 1.3-INT-013  # Prettier injection prevention
bun test 1.3-INT-019  # TS config write
bun test 1.3-INT-024  # Parallel validation
bun test 1.3-INT-025  # Validation failure → rollback
bun test 1.3-INT-029  # Atomic rollback
bun test 1.3-INT-030  # Rollback during write
```

### Phase 3: E2E (P0) - 15 minutes

```bash
# Critical user journeys
bun test 1.3-E2E-001  # Full wizard happy path
bun test 1.3-E2E-005  # Injection attempt blocked
bun test 1.3-E2E-008  # All tools validate
bun test 1.3-E2E-010  # Cancel + rollback
```

### Phase 4: P1 Tests - 30 minutes

All P1 unit, integration, and E2E tests

### Phase 5: P2/P3 Tests - As time permits

Lower priority tests for edge cases and polish

**Total Estimated Execution Time**: ~60 minutes for full suite

---

## Test Environments

### Local Development

- **Runner**: Bun Test (backend), Vitest (Ink components)
- **Database**: SQLite in-memory
- **File System**: Temporary directories with cleanup
- **Isolation**: Each test gets fresh wizard instance

### CI/CD Pipeline

- **Parallel Execution**: 4 concurrent workers
- **Timeout**: 5 minutes per test, 90 minutes total
- **Retry**: Flaky tests retry once (E2E only)
- **Reporting**: JUnit XML + coverage report

### Pre-Release Testing

- **Manual QA**: E2E scenarios with real projects
- **Security Scan**: SAST on generated configs
- **Performance**: Load test with 10,000 file project
- **Beta Testing**: 10 developers with diverse projects

---

## Coverage Gaps and Limitations

### Identified Gaps

1. **SQLite Persistence** (DATA-001):
   - Limited coverage: Only 1.3-UNIT-005 tests serialization
   - Recommendation: Add 2 integration tests for SQLite write failure and retry

2. **Detection Engine Timeout** (TECH-002):
   - Tests rely on Story 1.2 implementation
   - Recommendation: Add explicit timeout test with mocked slow detection

3. **Network Mounted File Systems**:
   - No specific tests for network latency
   - Recommendation: Add P2 test with simulated network delays

### Acceptable Limitations

1. **Third-Party Tool Behavior**:
   - ESLint/Prettier/TypeScript validation assumes tools work correctly
   - Mitigation: Version pin dependencies, test with known-good versions

2. **Operating System Differences**:
   - Path handling tested on POSIX primarily
   - Mitigation: CI runs on macOS, Linux, Windows

3. **Extreme Edge Cases**:
   - 100,000+ file projects not tested (P3)
   - Mitigation: Document max recommended project size (10,000 files)

---

## Test Maintenance Strategy

### Review Triggers

- New Ink or Zustand version (update state management tests)
- Detection engine changes from Story 1.2 (update integration tests)
- New config tool added (replicate test pattern for new tool)
- Security vulnerability in dependencies (add regression test)

### Test Health Metrics

- **Flakiness**: <1% flaky test rate (rewrite if >3% flaky)
- **Execution Time**: <5 seconds per unit test, <30 seconds per integration
- **Coverage**: Maintain >90% line coverage on wizard service logic

### Deprecation Plan

- Remove duplicate tests if coverage overlaps
- Archive P3 tests for rarely-used features after 6 months no-fail
- Migrate to E2E if integration tests become too brittle

---

## Appendix: Test Scenario Quick Reference

### By Priority

**P0 (28 tests)**: Critical security, state management, rollback
**P1 (35 tests)**: Core wizard features, config generation, validation
**P2 (18 tests)**: Merge scenarios, error handling, cleanup
**P3 (6 tests)**: Edge cases, cosmetic, rare configurations

### By Risk Mitigation

**Critical Risks (17 tests)**: TECH-001, SEC-001, OPS-001
**High Risks (12 tests)**: TECH-002, DATA-001, PERF-001, SEC-002
**Medium Risks (12 tests)**: TECH-003, DATA-002, PERF-002, BUS-001
**Low Risks (8 tests)**: OPS-002, DATA-003, TECH-004

### By Test Type

**Happy Path (32 tests)**: Expected user flows, valid inputs
**Error Path (28 tests)**: Validation failures, permission errors, rollback
**Edge Cases (18 tests)**: Monorepos, large projects, legacy configs
**Security (9 tests)**: Injection prevention, path traversal, sanitization

---

**Test Design Complete**: 87 scenarios identified
**Next Step**: Execute trace-requirements task to map tests to Given-When-Then format
**Review**: Test Architect sign-off required before implementation begins

---

**Report Generated**: 2025-09-29
**Designer**: Quinn (Test Architect) 🧪
